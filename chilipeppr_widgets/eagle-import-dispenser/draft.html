
            // load somewhere in init of parent widget
            chilipeppr.load("#com-chilipeppr-widgetholder-wcs", "http://fiddle.jshell.net/chilipeppr/xz76L1yd/show/light/", function() {
                cprequire(["inline:com-chilipeppr-widget-wcs"], function (wcs) {
                    console.log("test running of " + wcs.id);
                    wcs.init();
                });
            });


#######################################################

            
             <button type="button" class="btn btn-xs btn-default btn-eagle-sendgcodetows" style="margin: 4px 0;">Send Gcode to Workspace</button>

             <div class="panel eagle-advanced" style="margin-bottom:10px;">
             <!-- Dispense Setting -->
                 <div class="checkbox">
                     <label>
                        <input type="checkbox" class="dispenser-active" checked><h2>Solder Dispenser</h2></input>
                     </label>
                 </div>
                 <div class="btn-group">
                     <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown"> <span class="caret"></span></button>
                     <ul class="dropdown-menu" role="menu">
                        <!--
                        Size and product code from ebay offer:
                        http://www.ebay.de/itm/321327139655

                        TA14	Teliasia	14GA TAPERED TIP	1.55	Olive	1.25	1pc
                        TA16	Teliasia	16GA TAPERED TIP	1.2	Grey	1.25	1pc
                        TA18	Teliasia	18GA TAPERED TIP	0.84	Green	1.25	1pc
                        TA20	Teliasia	20GA TAPERED TIP	0.58	Pink	1.25	1pc
                        TA22	Teliasia	22GA TAPERED TIP	0.41	Blue	1.25	1pc
                        TA25	Teliasia	25GA TAPERED TIP	0.26	Red	1.25	1pc
                        
                        BL14050	Teliasia	14GA Blunt End Tip 	1.55	2.1	Olive	0.5	1pc
                        BL15050	Teliasia	15GA Blunt End Tip 	1.36	1.8	Amber	0.5	1pc
                        BL18050	Teliasia	18GA Blunt End Tip 	0.84	1.27	Green	0.5	1pc
                        BL20050	Teliasia	20GA Blunt End Tip 	0.6	0.92	Pink	0.5	1pc
                        BL21050	Teliasia	21GA Blunt End Tip 	0.51	0.82	Purple	0.5	1pc
                        BL22050	Teliasia	22GA Blunt End Tip 	0.41	0.72	Blue	0.5	1pc
                        BL23050	Teliasia	23GA Blunt End Tip 	0.34	0.64	Orange	0.5	1pc
                        BL25050	Teliasia	25GA Blunt End Tip 	0.26	0.52	Red	0.5	1pc
                        BL27050	Teliasia	27GA Blunt End Tip 	0.21	0.42	Clear	0.5	1pc
                        -->

                         <li role="presentation" class="dropdown-header">Color and inside diameter of canullas</li>
                         <li><a diameter="1.55" href="">Olive  - 1.55 mm</a></li>
                         <li><a diameter="1.36" href="">Amber  - 1.36 mm</a></li>
                         <li><a diameter="1.20" href="">Grey   - 1.20 mm</a></li>
                         <li><a diameter="0.84" href="">Green  - 0.84 mm</a></li>
                         <li><a diameter="0.60" href="">Pink   - 0.60 mm</a></li>
                         <li><a diameter="0.51" href="">Purple - 0.51 mm</a></li>
                         <li><a diameter="0.51" href="">Blue   - 0.41 mm</a></li>
                         <li><a diameter="0.34" href="">Orange - 0.34 mm</a></li>
                         <li><a diameter="0.26" href="">Red    - 0.26 mm</a></li>
                         <li><a diameter="0.21" href="">Clear  - 0.21 mm</a></li>
                     </ul>&nbsp;Insidediameter of canulla in mm
                 </div>
                <div class="input-group">
                    <input class="form-control cannulaDiameter" type="number" placeholder="Cannula" value="1" xdisabled />
                    <div class="input-group-addon">mm</div>
                </div>
                <p class="descriptive-text">
                  Diameter from Cannula, try first 1mm.
                </p>

                Steps for one drop
                <div class="input-group">
                    <input class="form-control stepsfordrop" type="number" placeholder="Steps" value="0.02" xdisabled />
                    <div class="input-group-addon">mm</div>
                </div>
                <p class="descriptive-text">
                  The steps for dispense a drop of Solder Paste. Think in metric, the default value 0.02mm.
                  But please try the test and configure your personal value. It depends from you parameters 
                  for stepper that installed on your second arduino.
                </p>

                Axis for Dispenser
                <div class="input-group">
                    <input class="form-control dispenserAxis" type="string" placeholder="Steps" value="X" xdisabled />
                </div>
                <p class="descriptive-text">
                  Please input the name of the Axis for Dispenser Stepper.<br/>
                </p>

                Dispenser Position Offset for X and Y-Axis
                <div class="input-group">
                    <div class="input-group-addon">X:</div>
                    <input class="form-control DispenserXoffset" type="number" placeholder="Offsets" value="0" xdisabled />
                    <div class="input-group-addon">mm</div>
                </div>
                <div class="input-group">
                    <div class="input-group-addon">Y:</div>
                    <input class="form-control DispenserYoffset" type="number" placeholder="Offsets" value="0" xdisabled />
                    <div class="input-group-addon">mm</div>
                </div>

                <p class="descriptive-text">
                  The Offset from middle of spindle to the middle of dispenser in mm.
                </p>

                Start and Release Offset
                <div class="input-group">
                    <input class="form-control startreleaseoffset" type="number" placeholder="Steps" value="1" xdisabled />
                    <div class="input-group-addon">mm</div>
                </div>
                <p class="descriptive-text">
                  Please input the start and release way in mm. After the dispense process, the pivot will release 
                  the press to prevent flow solder paste after the process. The default are 1mm<br/>
                </p>

             </div> 
             <!-- Dispense Setting -->
         
#######################################################

        cannulaDiameter: 1,
        stepsfordrop: 0.5,
        startreleaseoffset: 1.0,
        DispenserXoffset: 0.0,
        DispenserYoffset: 0.0,
        dispenserAxis: 'X',
        renderedDrops: [],
        renderDispenserDrops:function(){
            var that = this;

            // remove all old drops
            this.renderedDrops.forEach(function(thing) {
                that.sceneRemove(thing);
            }, this);

            if(! $('#com-chilipeppr-widget-eagle .dispenser-active').is(':checked'))
               return;
            
            // get all smd pads,
            var clippers = this.clipperBySignalKey;
            console.group("drawDispenserDrops");
            for ( keyname in clippers ){
               clippers[keyname].smds.forEach(function(smd){
                  // get absolute position'
                  var vector = new THREE.Vector3();
                  vector.setFromMatrixPosition( smd.threeObj.matrixWorld );

                  var diameter = that.cannulaDiameter+(that.cannulaDiameter/2);
                  var radius = diameter / 2;
                  var ar_drop = Math.PI * (radius*radius);
                  
                   // Calculate bigger smd pads as canulla diameter*2
                   // +-----+
                   // | O O |
                   // | O O |
                   // +-----+
                   var s = smd.smd;
                   console.log("SMD Pad: ", smd);
                   if(s.dx >= diameter*2 || s.dy >= diameter*2){
                        var steps_x = Math.round(s.dx/diameter);
                        var steps_y = Math.round(s.dy/diameter);
                        var space_x = (s.dx-(steps_x * diameter)) / steps_x;
                        var space_y = (s.dy-(steps_y * diameter)) / steps_y;

                        var startx = vector.x-(s.dx/2) + radius + (space_x/2);
                        var starty = vector.y-(s.dy/2) + radius + (space_y/2);

                        var group = new THREE.Object3D();//create an empty container
                        for(var iy=1; iy <= steps_y; iy++){
                           for(var ix=1; ix <= steps_x;ix++){
                              var drop = that.drawSphere(startx, starty, (that.cannulaDiameter/2), that.colorsDrop[0]);
                              group.add( drop );//add a mesh with geometry to it
                              startx += diameter + space_x;
                           }
                           startx = vector.x-(s.dx/2) + radius + (space_x/2);
                           starty += diameter + space_y;
                        }
                        that.renderedDrops.push(group);
                        if(s.rot != null){
                           // group.rotation.z = - parseInt(s.rot.substring(1)) * (Math.PI / 180);
                        }
                                                      
                        that.sceneAdd(group);
                   }  else {
                     // calculate area and mark drop with traffic colors
                     var ar_smd = s.dx * s.dy;
                     var percent = percent = ar_smd / (ar_drop/100); // area from drop greather then smd pad
                     if(ar_smd > ar_drop)                            // area from smd pad greather then drop
                        percent = ar_drop / (ar_smd/100);
                     var color = that.colorsDrop[0];
                     if(percent < 80)
                        color = that.colorsDrop[1];
                     if(percent < 50)
                        color = that.colorsDrop[2];
                     // draw a drop (cone) on this position
                     var drop = that.drawSphere(vector.x, vector.y, (that.cannulaDiameter/2), color);
                     that.sceneAdd(drop);
                     that.renderedDrops.push(drop);
                  }
               });
            }
            console.groupEnd("drawDispenserDrops");

            // finish
        },
        exportGcodeDispenserDrop:function(drop, count){
            var g = '';
            var that = this;

            var dropDepth = (that.cannulaDiameter/2).toFixed(4); // got to 1/2 Diameter height, means 1mm drop / Z:0.5mm

            var vector = new THREE.Vector3();
            vector.setFromMatrixPosition( drop.matrixWorld  );

            g += "(generate Drop Nr: " + count + ")\n";        // Comment to see the blocks
            g += "G0 F200 Z" + that.clearanceHeight + "\n";         // save height               i.e: Z:1mm
            g += "G0 X" + (vector.x + that.options.DispenserXoffset).toFixed(4)
                        + " Y" + (vector.y + that.options.DispenserYoffset).toFixed(4)
                        + "\n";                                // got to position of drop
            g += "G0 Z" + dropDepth  + "\n";                   // careful go to dropdepth        i.e: Z:0.05mm
            g += "(chilipeppr_pause drop" 
                  + count + " G1 F100 "  
                  + that.dispenserAxis 
                  + that.stepsfordrop 
                  + ")\n";                                     // Send pause event and wait for second cnc controller
            g += "G1 F200 Z" + that.clearanceHeight + "\n";          // slow go up to 1mm/3 =    i.e: Z:0.33mm

            return g;
        },
        exportGcodeDispenser:function(){
            var g = '';
            var that = this;

            if(! $('#com-chilipeppr-widget-eagle .dispenser-active').is(':checked'))
               return g;

            console.group('exportGcodeDispenser');

            g += "(------ DISPENSER DROP's -------)\n";
            g += "M5 (spindle stop)\n";

            // generate gcode for every drop
            var i = 0;
            this.renderedDrops.forEach(function(thing) {
               console.log('Thing', thing);      
               if(thing.type == 'Object3D'){
                  thing.children.forEach(function(drop){
                     g += that.exportGcodeDispenserDrop(drop, ++i);
                  });
               }
               else{
                  g += that.exportGcodeDispenserDrop(thing, ++i);
               }
            }, this);

            console.log('Dispenser GCODE', g);
            console.groupEnd('exportGcodeDispenser');
            return g;
        },
            el.find('.dispenserAxis').change(function(evt) {
                console.log("evt:", evt);
                that.options.dispenserAxis = that.dispenserAxis = evt.currentTarget.valueAsNumber;
                that.saveOptionsLocalStorage();
            });
            el.find('.stepsfordrop').change(function(evt) {
                console.log("evt:", evt);
                that.options.stepsfordrop = that.stepsfordrop = evt.currentTarget.valueAsNumber;
                that.saveOptionsLocalStorage();
            });
            el.find('.cannulaDiameter').change(function(evt) {
                console.log("evt:", evt);
                that.options.cannulaDiameter = that.cannulaDiameter = evt.currentTarget.valueAsNumber;
                that.saveOptionsLocalStorage();
            });
            el.find('.startreleaseoffset').change(function(evt) {
                console.log("evt:", evt);
                that.options.startreleaseoffset = that.startreleaseoffset = evt.currentTarget.valueAsNumber;
                that.saveOptionsLocalStorage();
            });
            el.find('.DispenserXoffset').change(function(evt) {
                console.log("evt:", evt);
                that.options.DispenserXoffset = that.DispenserXoffset = evt.currentTarget.valueAsNumber;
                that.saveOptionsLocalStorage();
            });
            el.find('.DispenserYoffset').change(function(evt) {
                console.log("evt:", evt);
                that.options.DispenserYoffset = that.DispenserYoffset = evt.currentTarget.valueAsNumber;
                that.saveOptionsLocalStorage();
            });
